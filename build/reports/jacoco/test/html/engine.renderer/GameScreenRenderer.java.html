<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GameScreenRenderer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">space_Invaders</a> &gt; <a href="index.source.html" class="el_package">engine.renderer</a> &gt; <span class="el_source">GameScreenRenderer.java</span></div><h1>GameScreenRenderer.java</h1><pre class="source lang-java linenums">package engine.renderer;

import animations.BasicGameSpace;
import animations.Explosion;
import engine.AssetManager;
import engine.Core;
import engine.gameplay.achievement.Achievement;
import entity.Entity;
import screen.Screen;

import java.awt.*;
import java.util.Iterator;
import java.util.List;
import java.util.Random;
import java.util.logging.Logger;

public class GameScreenRenderer {

<span class="nc" id="L19">    private static Logger LOGGER = null;</span>
    private CommonRenderer commonRenderer;
    private EntityRenderer entityRenderer;
    /** Font properties. */
    private static FontMetrics fontMetrics;

<span class="nc" id="L25">    private final List&lt;Explosion&gt; explosions = new java.util.ArrayList&lt;&gt;();</span>
<span class="nc" id="L26">    BasicGameSpace basicGameSpace = new BasicGameSpace(100);</span>

<span class="nc" id="L28">    public GameScreenRenderer(CommonRenderer commonRenderer) {</span>
<span class="nc" id="L29">        LOGGER = Core.getLogger();</span>
<span class="nc" id="L30">        this.commonRenderer = commonRenderer;</span>
<span class="nc" id="L31">        this.entityRenderer = new EntityRenderer(commonRenderer);</span>
<span class="nc" id="L32">    }</span>

    public void setLastLife(boolean status) {
<span class="nc" id="L35">        basicGameSpace.setLastLife(status);</span>
<span class="nc" id="L36">    }</span>

    /**
     * Countdown to game start.
     *
     * @param screen
     *                  Screen to draw on.
     * @param level
     *                  Game difficulty level.
     * @param number
     *                  Countdown number.
     * @param bonusLife
     *                  Checks if a bonus life is received.
     */
    public void drawCountDown(Graphics g, final Screen screen, final int level, final int number, final boolean bonusLife) {
<span class="nc" id="L51">        int rectWidth = screen.getWidth();</span>
<span class="nc" id="L52">        int rectHeight = screen.getHeight() / 6;</span>
<span class="nc" id="L53">        g.setColor(Color.BLACK);</span>
<span class="nc" id="L54">        g.fillRect(0, screen.getHeight() / 2 - rectHeight / 2, rectWidth, rectHeight);</span>
<span class="nc" id="L55">        g.setColor(Color.GREEN);</span>
<span class="nc" id="L56">        fontMetrics = g.getFontMetrics(commonRenderer.getFontBig());</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">        if (number &gt;= 4) {</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">            if (!bonusLife) {</span>
<span class="nc" id="L59">                commonRenderer.drawCenteredBigString(g, screen, &quot;Level &quot; + level, screen.getHeight() / 2 + fontMetrics.getHeight() / 3);</span>
            } else {
<span class="nc" id="L61">                commonRenderer.drawCenteredBigString(g, screen, &quot;Level &quot; + level + &quot; - Bonus life!&quot;, screen.getHeight() / 2 + fontMetrics.getHeight() / 3);</span>
            }
<span class="nc bnc" id="L63" title="All 2 branches missed.">        } else if (number != 0) {</span>
<span class="nc" id="L64">            commonRenderer.drawCenteredBigString(g, screen, Integer.toString(number), screen.getHeight() / 2 + fontMetrics.getHeight() / 3);</span>
        } else {
<span class="nc" id="L66">            commonRenderer.drawCenteredBigString(g, screen, &quot;GO!&quot;, screen.getHeight() / 2 + fontMetrics.getHeight() / 3);</span>
        }
<span class="nc" id="L68">    }</span>

    /**
     * Draws achievement toasts.
     *
     * @param screen
     * Screen to draw on.
     * @param toasts
     * List of toasts to draw.
     */
    public void drawAchievementToasts(Graphics g, final Screen screen, final List&lt;Achievement&gt; toasts) {
<span class="nc bnc" id="L79" title="All 4 branches missed.">        if (toasts == null || toasts.isEmpty()) {</span>
<span class="nc" id="L80">            return;</span>
        }

<span class="nc" id="L83">        Achievement achievement = toasts.getLast();</span>
<span class="nc" id="L84">        Graphics2D g2d = (Graphics2D) g.create();</span>

        try {
<span class="nc" id="L87">            int box_width = 350;</span>
<span class="nc" id="L88">            int box_height = 110;</span>
<span class="nc" id="L89">            int cornerRadius = 15;</span>

<span class="nc" id="L91">            int x = (screen.getWidth() - box_width) / 2;</span>
<span class="nc" id="L92">            int y = (screen.getHeight() - box_height) / 2;</span>

<span class="nc" id="L94">            g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>

<span class="nc" id="L96">            g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.3f));</span>
<span class="nc" id="L97">            g2d.setColor(Color.BLACK);</span>
<span class="nc" id="L98">            g2d.fillRoundRect(x, y, box_width, box_height, cornerRadius, cornerRadius);</span>

<span class="nc" id="L100">            g2d.setColor(Color.GREEN);</span>
<span class="nc" id="L101">            g2d.setStroke(new BasicStroke(2));</span>
<span class="nc" id="L102">            g2d.drawRoundRect(x, y, box_width, box_height, cornerRadius, cornerRadius);</span>

<span class="nc" id="L104">            g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_OVER, 0.7f));</span>

<span class="nc" id="L106">            g2d.setFont(commonRenderer.getFontBig());</span>
<span class="nc" id="L107">            g2d.setColor(Color.YELLOW);</span>
<span class="nc" id="L108">            FontMetrics bigMetrics = g2d.getFontMetrics(commonRenderer.getFontBig());</span>
<span class="nc" id="L109">            int titleWidth = bigMetrics.stringWidth(&quot;Achievement Clear!&quot;);</span>
<span class="nc" id="L110">            g2d.drawString(&quot;Achievement Clear!&quot;, (screen.getWidth() - titleWidth) / 2, y + 35);</span>

<span class="nc" id="L112">            g2d.setFont(commonRenderer.getFontRegular());</span>
<span class="nc" id="L113">            g2d.setColor(Color.WHITE);</span>
<span class="nc" id="L114">            FontMetrics regularMetrics = g2d.getFontMetrics(commonRenderer.getFontRegular());</span>
<span class="nc" id="L115">            int nameWidth = regularMetrics.stringWidth(achievement.getName());</span>
<span class="nc" id="L116">            g2d.drawString(achievement.getName(), (screen.getWidth() - nameWidth) / 2, y + 60);</span>

<span class="nc" id="L118">            g2d.setColor(Color.LIGHT_GRAY);</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">            if (achievement.getDescription().length() &lt; 30) {</span>
<span class="nc" id="L121">                int descWidth = regularMetrics.stringWidth(achievement.getDescription());</span>
<span class="nc" id="L122">                g2d.drawString(achievement.getDescription(), (screen.getWidth() - descWidth) / 2, y + 80 + regularMetrics.getHeight()/2);</span>
<span class="nc" id="L123">            } else {</span>
                // 30 characters or more to handle the wrap
<span class="nc" id="L125">                String line1 = achievement.getDescription().substring(0, achievement.getDescription().length()/2);</span>
<span class="nc" id="L126">                String line2 = achievement.getDescription().substring(achievement.getDescription().length()/2);</span>

                // first line
<span class="nc" id="L129">                int line1_width = regularMetrics.stringWidth(line1);</span>
<span class="nc" id="L130">                g2d.drawString(line1, (screen.getWidth() - line1_width) / 2, y + 80);</span>

                // second line
<span class="nc" id="L133">                int line2_width = regularMetrics.stringWidth(line2);</span>
<span class="nc" id="L134">                g2d.drawString(line2, (screen.getWidth() - line2_width) / 2, y + 80 + regularMetrics.getHeight());</span>
            }
        } finally {
<span class="nc" id="L137">            g2d.dispose();</span>
        }
<span class="nc" id="L139">    }</span>

    /**
     * Draws current score on screen.
     *
     * @param screen
     *               Screen to draw on.
     * @param score
     *               Current score.
     */
    public void drawScore(Graphics g, final Screen screen, final int score) {
<span class="nc" id="L150">        Font font = AssetManager.getInstance().getFontRegular();</span>
<span class="nc" id="L151">        g.setFont(font);</span>
<span class="nc" id="L152">        g.setColor(Color.WHITE);</span>
<span class="nc" id="L153">        String scoreString = String.format(&quot;%04d&quot;, score);</span>
<span class="nc" id="L154">        g.drawString(scoreString, screen.getWidth() - 60, 25);</span>
<span class="nc" id="L155">    }</span>

    /**
     * Draws number of remaining lives on screen.
     *
     * @param screen    Screen to draw on.
     * @param lives    Whether the game is in co-op mode.
     */


    public void drawLives(Graphics g, final Screen screen, final int lives, final boolean isCoop) {
<span class="nc" id="L166">        g.setFont(commonRenderer.getFontRegular());</span>
<span class="nc" id="L167">        g.setColor(Color.WHITE);</span>

<span class="nc" id="L169">        Entity heart = new Entity(0, 0, 11*2, 10*2, Color.RED) {</span>
<span class="nc" id="L170">            { this.spriteType = AssetManager.SpriteType.Heart; }</span>
        };

<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (isCoop) {</span>
<span class="nc" id="L174">            g.drawString(Integer.toString(lives), 20, 25);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            for (int i = 0; i &lt; lives; i++) {</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">                if (i &lt; 3) {</span>
<span class="nc" id="L177">                    entityRenderer.drawEntity(g, heart, 40 + 35 * i, 9);</span>
                } else {
<span class="nc" id="L179">                    entityRenderer.drawEntity(g, heart, 40 + 35 * (i - 3), 9 + 25);</span>
                }
            }
        }
        else {
<span class="nc" id="L184">            g.drawString(Integer.toString(lives), 20, 40);</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">            for (int i = 0; i&lt;lives; i++) {</span>
<span class="nc" id="L186">                entityRenderer.drawEntity(g, heart, 40 + 35 * i, 23);</span>
            }
        }
<span class="nc" id="L189">    }</span>

    /**
     * Draws current coin count on screen.
     *
     * @param screen
     *               Screen to draw on.
     * @param coins
     *               Current coin count.
     */
    public void drawCoins(Graphics g, final Screen screen, final int coins) {
<span class="nc" id="L200">        g.setFont(commonRenderer.getFontRegular());</span>
<span class="nc" id="L201">        g.setColor(Color.YELLOW);</span>
<span class="nc" id="L202">        g.drawString(String.format(&quot;%04d&quot;, coins), screen.getWidth() - 60, 52);</span>
<span class="nc" id="L203">        g.drawString(&quot;COIN : &quot;, screen.getWidth() - 115, 52);</span>
<span class="nc" id="L204">    }</span>

    // 2P mode: drawCoins method but for both players, but separate coin counts
    public void drawCoins(Graphics g, final Screen screen, final int coinsP1, final int coinsP2) {
<span class="nc" id="L208">        g.setFont(commonRenderer.getFontRegular());</span>
<span class="nc" id="L209">        g.setColor(Color.YELLOW);</span>
<span class="nc" id="L210">        g.drawString(&quot;P1: &quot; + String.format(&quot;%04d&quot;, coinsP1), screen.getWidth() - 200, 25);</span>
<span class="nc" id="L211">        g.drawString(&quot;P2: &quot; + String.format(&quot;%04d&quot;, coinsP2), screen.getWidth() - 100, 25);</span>
<span class="nc" id="L212">    }</span>

    public void drawLevel (Graphics g, final Screen screen, final int level) {
<span class="nc" id="L215">        g.setColor(Color.WHITE);</span>
<span class="nc" id="L216">        String levelString = &quot;Level &quot; + level;</span>
<span class="nc" id="L217">        g.drawString(levelString, screen.getWidth()-250, 25);</span>
<span class="nc" id="L218">    }</span>

    public void drawShipCount (Graphics g, final Screen screen, final int shipCount) {
<span class="nc" id="L221">        g.setColor(Color.GREEN);</span>
<span class="nc" id="L222">        Entity enemyIcon = new Entity(0, 0, 12*2, 8*2, Color.GREEN) {</span>
<span class="nc" id="L223">            { this.spriteType = AssetManager.SpriteType.EnemyShipB2; }</span>
        };
<span class="nc" id="L225">        int iconX = screen.getWidth() - 252;</span>
<span class="nc" id="L226">        int iconY = 37;</span>
<span class="nc" id="L227">        entityRenderer.drawEntity(g, enemyIcon, iconX, iconY);</span>
<span class="nc" id="L228">        String shipString = &quot;: &quot; + shipCount;</span>
<span class="nc" id="L229">        g.drawString(shipString, iconX + 30, 52);</span>
<span class="nc" id="L230">    }</span>

    public void triggerExplosion(int x, int y, boolean enemy, boolean finalExplosion) {
<span class="nc" id="L233">        LOGGER.info(&quot;Enemy: &quot;+enemy);</span>
<span class="nc" id="L234">        LOGGER.info(&quot;final: &quot;+finalExplosion);</span>
<span class="nc" id="L235">        explosions.add(new Explosion(x, y, enemy, finalExplosion));</span>
<span class="nc" id="L236">    }</span>

    public void drawExplosions(Graphics g, Screen screen) {

<span class="nc" id="L240">        Graphics2D g2d = (Graphics2D) g;</span>
<span class="nc" id="L241">        g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span>

<span class="nc" id="L243">        g2d.setColor(Color.WHITE);</span>


<span class="nc" id="L246">        Iterator&lt;Explosion&gt; iterator = explosions.iterator();</span>

<span class="nc bnc" id="L248" title="All 2 branches missed.">        while(iterator.hasNext()){</span>
<span class="nc" id="L249">            Explosion e = iterator.next();</span>
<span class="nc" id="L250">            e.update();</span>

<span class="nc bnc" id="L252" title="All 2 branches missed.">            if (!e.isActive()) {</span>
<span class="nc" id="L253">                iterator.remove();</span>
<span class="nc" id="L254">                continue;</span>
            }

<span class="nc bnc" id="L257" title="All 2 branches missed.">            for(Explosion.Particle p : e.getParticles()){</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">                if(!p.active){</span>
<span class="nc" id="L259">                    continue;</span>
                }

                int baseSize;

<span class="nc" id="L264">                Random random = new Random();</span>
<span class="nc bnc" id="L265" title="All 2 branches missed.">                if (e.getSize() == 4)</span>
<span class="nc" id="L266">                    baseSize = random.nextInt(5) + 2;</span>
                else
<span class="nc" id="L268">                    baseSize = random.nextInt(6)+18;</span>

<span class="nc" id="L270">                int flickerAlpha = Math.max(0, Math.min(255, p.color.getAlpha() - (int)(Math.random() * 50)));</span>


<span class="nc" id="L273">                float[] dist = {0.0f, 0.3f, 0.7f, 1.0f};</span>
                Color[] colors;
<span class="nc bnc" id="L275" title="All 2 branches missed.">                if(e.enemy()){</span>
<span class="nc" id="L276">                    colors = new Color[]{</span>
                            new Color(255, 255, 250, flickerAlpha),
                            new Color(255, 250, 180, flickerAlpha),
                            new Color(255, 200, 220, flickerAlpha / 2),
                            new Color(0, 0, 0, 0)
                    };
                }
                else{
<span class="nc" id="L284">                    colors = new Color[]{</span>
                            new Color(255, 255, 180, flickerAlpha),
                            new Color(255, 200, 0, flickerAlpha),
                            new Color(255, 80, 0, flickerAlpha / 2),
                            new Color(0, 0, 0, 0)
                    };
                }

<span class="nc" id="L292">                RadialGradientPaint paint = new RadialGradientPaint(</span>
                        new Point((int) p.x, (int) p.y),
                        baseSize,
                        dist,
                        colors
                );

<span class="nc" id="L299">                g2d.setPaint(paint);</span>

<span class="nc" id="L301">                int offsetX = (int) (Math.random() * 4 - 2);</span>
<span class="nc" id="L302">                int offsetY = (int) (Math.random() * 4 - 2);</span>

<span class="nc" id="L304">                g2d.fillOval(</span>
                        (int) (p.x - baseSize / 2 + offsetX),
                        (int) (p.y - baseSize / 2 + offsetY),
                        baseSize,
                        baseSize
                );
            }
<span class="nc" id="L311">        }</span>
<span class="nc" id="L312">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>