<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EntityRenderer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">space_Invaders</a> &gt; <a href="index.source.html" class="el_package">engine.renderer</a> &gt; <span class="el_source">EntityRenderer.java</span></div><h1>EntityRenderer.java</h1><pre class="source lang-java linenums">package engine.renderer;

import engine.AssetManager;
import entity.Bullet;
import entity.Entity;
import entity.Ship;

import java.awt.*;

public class EntityRenderer {

    private CommonRenderer commonRenderer;

<span class="nc" id="L14">    public EntityRenderer(CommonRenderer commonRenderer) {</span>
<span class="nc" id="L15">        this.commonRenderer = commonRenderer;</span>
<span class="nc" id="L16">    }</span>

    /**
     * Draws an entity, using the appropriate image.
     *
     * @param entity
     *                  Entity to be drawn.
     * @param positionX
     *                  Coordinates for the left side of the image.
     * @param positionY
     *                  Coordinates for the upper side of the image.
     */
    public void drawEntity(Graphics g, final Entity entity, final int positionX, final int positionY) {
        // [수정] AssetManager 인스턴스를 직접 가져와 spriteMap을 대체합니다.
<span class="nc" id="L30">        AssetManager assetManager = AssetManager.getInstance();</span>
<span class="nc" id="L31">        boolean[][] image = assetManager.getSprite(entity.getSpriteType());</span>

        // [추가] 스프라이트를 찾지 못했을 때 오류가 나지 않도록 방어 코드 추가
<span class="nc bnc" id="L34" title="All 2 branches missed.">        if (image == null) {</span>
<span class="nc" id="L35">            g.setColor(Color.PINK); // 누락된 스프라이트를 쉽게 식별하도록 분홍색으로 표시</span>
<span class="nc" id="L36">            g.fillRect(positionX, positionY, entity.getWidth(), entity.getHeight());</span>
<span class="nc" id="L37">            System.err.println(&quot;EntityRenderer: Can't find sprite about &quot; + entity.getSpriteType());</span>
<span class="nc" id="L38">            return;</span>
        }

        // 2P mode: start with the entity's own color
<span class="nc" id="L42">        final Color color = getColor(entity);</span>

        // --- Scaling logic ---
        // Original sprite dimensions
<span class="nc" id="L46">        int spriteWidth = image.length;</span>
<span class="nc" id="L47">        int spriteHeight = image[0].length;</span>

        // Entity dimensions (modified via Bullet constructor or other entities)
<span class="nc" id="L50">        int entityWidth = entity.getWidth();</span>
<span class="nc" id="L51">        int entityHeight = entity.getHeight();</span>

        // Calculate scaling ratios compared to original sprite
<span class="nc" id="L54">        float widthRatio = (float) entityWidth / (spriteWidth * 2);</span>
<span class="nc" id="L55">        float heightRatio = (float) entityHeight / (spriteHeight * 2);</span>
        // --- End of scaling logic ---

        // Set drawing color again
<span class="nc" id="L59">        g.setColor(color);</span>
        // Draw the sprite with scaling applied
<span class="nc bnc" id="L61" title="All 2 branches missed.">        for (int i = 0; i &lt; spriteWidth; i++) {</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">            for (int j = 0; j &lt; spriteHeight; j++) {</span>
<span class="nc bnc" id="L63" title="All 2 branches missed.">                if (image[i][j]) {</span>
                    // Apply calculated scaling ratio to pixel positions and size
<span class="nc" id="L65">                    g.fillRect(positionX + (int)(i * 2 * widthRatio),</span>
                            positionY + (int)(j * 2 * heightRatio),
<span class="nc" id="L67">                            (int)Math.ceil(widthRatio * 2), // Adjust the width of the pixel</span>
<span class="nc" id="L68">                            (int)Math.ceil(heightRatio * 2) // Adjust the height of the pixel</span>
                    );
                }
            }
        }
<span class="nc" id="L73">    }</span>

    private static Color getColor(Entity entity) {
<span class="nc" id="L76">        Color color = entity.getColor();</span>

        // Color-code by player when applicable
<span class="nc bnc" id="L79" title="All 2 branches missed.">        if (entity instanceof Ship) {</span>
<span class="nc" id="L80">            Ship ship = (Ship) entity;</span>
<span class="nc" id="L81">            int pid = ship.getPlayerId(); // requires Ship.getPlayerId()</span>
<span class="nc bnc" id="L82" title="All 2 branches missed.">            if (pid == 1)</span>
<span class="nc" id="L83">                color = Color.BLUE; // P1 ship</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">            else if (pid == 2)</span>
<span class="nc" id="L85">                color = Color.RED; // P2 ship</span>

            // else leave default (e.g., green) for legacy/unknown
<span class="nc bnc" id="L88" title="All 2 branches missed.">        } else if (entity instanceof Bullet) {</span>
<span class="nc" id="L89">            Bullet bullet = (Bullet) entity;</span>
<span class="nc" id="L90">            int pid = bullet.getPlayerId(); // requires Bullet.getPlayerId()</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">            if (pid == 1)</span>
<span class="nc" id="L92">                color = Color.CYAN; // P1 bullet</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">            else if (pid == 2)</span>
<span class="nc" id="L94">                color = Color.MAGENTA; // P2 bullet</span>
            // enemy bullets will keep their default color from the entity
        }

<span class="nc bnc" id="L98" title="All 2 branches missed.">        if (entity instanceof entity.EnemyShip) {</span>
<span class="nc" id="L99">            entity.EnemyShip enemy = (entity.EnemyShip) entity;</span>
<span class="nc bnc" id="L100" title="All 4 branches missed.">            if ((enemy.getSpriteType() == AssetManager.SpriteType.EnemyShipA1 || enemy.getSpriteType() == AssetManager.SpriteType.EnemyShipA2)</span>
<span class="nc bnc" id="L101" title="All 2 branches missed.">                    &amp;&amp; enemy.getHealth() == 1) {</span>
<span class="nc" id="L102">                color = new Color(color.getRed(), color.getGreen(), color.getBlue(), 32);</span>
            }
        }
<span class="nc" id="L105">        return color;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>