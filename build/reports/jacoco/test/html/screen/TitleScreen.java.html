<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TitleScreen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">space_Invaders</a> &gt; <a href="index.source.html" class="el_package">screen</a> &gt; <span class="el_source">TitleScreen.java</span></div><h1>TitleScreen.java</h1><pre class="source lang-java linenums">package screen;

import java.awt.*;
import java.awt.event.KeyEvent;

import engine.utils.Cooldown;
import engine.Core;
import engine.SoundManager;

/**
 * Implements the title screen.
 *
 * @author &lt;a href=&quot;mailto:RobertoIA1987@gmail.com&quot;&gt;Roberto Izquierdo Amo&lt;/a&gt;
 *
 */
public class TitleScreen extends Screen {

    // 2P mode: user picks mode, where false = 1P, true = 2P
<span class="nc" id="L19">    private boolean coopSelected = false;</span>

	/** Milliseconds between changes in user selection. */
	private static final int SELECTION_TIME = 200;

	/** Time between changes in user selection. */
	private Cooldown selectionCooldown;

    // menu index added for user mode selection
<span class="nc" id="L28">    private int menuIndex = 0;</span>


	/** Added variable to store which menu option is currently hovered */
<span class="nc" id="L32">	private Integer hoverOption = null;</span>

	/**
	 * Constructor, establishes the properties of the screen.
	 *
	 * @param width
	 *            Screen width.
	 * @param height
	 *            Screen height.
	 * @param fps
	 *            Frames per second, frame rate at which the game is run.
	 */
	public TitleScreen(final int width, final int height, final int fps) {
<span class="nc" id="L45">		super(width, height, fps);</span>

		// Defaults to play.
<span class="nc" id="L48">		this.returnCode = 1; // 2P mode: changed to default selection as 1P</span>
<span class="nc" id="L49">		this.selectionCooldown = Core.getCooldown(SELECTION_TIME);</span>
<span class="nc" id="L50">		this.selectionCooldown.reset();</span>

        // Start menu music loop when the title screen is created
<span class="nc" id="L53">        Core.getSoundManager().playLoop(&quot;title_sound&quot;);</span>
<span class="nc" id="L54">	}</span>

	/**
	 * Starts the action.
	 *
	 * @return Next screen code.
	 */
	public final int run() {
<span class="nc" id="L62">		super.run();</span>
        // Stop menu music when leaving the title screen
<span class="nc" id="L64">        SoundManager.loopStop();</span>
<span class="nc" id="L65">		return this.returnCode;</span>
	}

	/**
	 * Updates the elements on screen and checks for events.
	 */
	protected final void update() {
<span class="nc" id="L72">        super.update();</span>

<span class="nc" id="L74">        draw();</span>
<span class="nc bnc" id="L75" title="All 4 branches missed.">        if (this.selectionCooldown.checkFinished() &amp;&amp; this.inputDelay.checkFinished()) {</span>
<span class="nc bnc" id="L76" title="All 4 branches missed.">            if (inputManager.isKeyDown(KeyEvent.VK_UP) || inputManager.isKeyDown(KeyEvent.VK_W)) {</span>
<span class="nc" id="L77">                SoundManager.playOnce(&quot;hover&quot;);</span>
<span class="nc" id="L78">                previousMenuItem();</span>
<span class="nc" id="L79">                this.selectionCooldown.reset();</span>
<span class="nc" id="L80">                this.hoverOption = null;</span>
            }
<span class="nc bnc" id="L82" title="All 4 branches missed.">            if (inputManager.isKeyDown(KeyEvent.VK_DOWN) || inputManager.isKeyDown(KeyEvent.VK_S)) {</span>
<span class="nc" id="L83">                SoundManager.playOnce(&quot;hover&quot;);</span>
<span class="nc" id="L84">                nextMenuItem();</span>
<span class="nc" id="L85">                this.selectionCooldown.reset();</span>
<span class="nc" id="L86">                this.hoverOption = null;</span>
            }

            // Play : Adjust the case so that 1p and 2p can be determined within the play.
<span class="nc bnc" id="L90" title="All 2 branches missed.">            if (inputManager.isKeyDown(KeyEvent.VK_SPACE)) {</span>
<span class="nc" id="L91">                SoundManager.playOnce(&quot;select&quot;);</span>
<span class="nc bnc" id="L92" title="All 6 branches missed.">                switch (this.menuIndex) {</span>
                    case 0: // &quot;Play&quot;
<span class="nc" id="L94">                        this.returnCode = 5; // go to PlayScreen</span>
<span class="nc" id="L95">                        this.isRunning = false;</span>
<span class="nc" id="L96">                        break;</span>

                    case 1: // &quot;Achievements&quot;
<span class="nc" id="L99">                        this.returnCode = 3;</span>
<span class="nc" id="L100">                        this.isRunning = false;</span>
<span class="nc" id="L101">                        break;</span>
                    case 2: // &quot;High scores&quot;
<span class="nc" id="L103">                        this.returnCode = 8;</span>
<span class="nc" id="L104">                        this.isRunning = false;</span>
<span class="nc" id="L105">                        break;</span>
                    case 3: // &quot;Settings&quot;
<span class="nc" id="L107">                        this.returnCode = 4;</span>
<span class="nc" id="L108">                        this.isRunning = false;</span>
<span class="nc" id="L109">                        break;</span>

                    case 4: // &quot;Quit&quot;
<span class="nc" id="L112">                        this.returnCode = 0;</span>
<span class="nc" id="L113">                        this.isRunning = false;</span>
<span class="nc" id="L114">                        break;</span>

                    default:
                        break;
                }
            }
<span class="nc bnc" id="L120" title="All 2 branches missed.">            if (inputManager.isMouseClicked()) {</span>
<span class="nc" id="L121">                int temp_x = inputManager.getMouseX();</span>
<span class="nc" id="L122">                int temp_y = inputManager.getMouseY();</span>

<span class="nc" id="L124">                Rectangle[] boxes = Core.getHitboxManager().getMenuHitboxes(drawManager.getBackBufferGraphics(), this);</span>
<span class="nc" id="L125">                int[] pos = {5, 3, 8, 4, 0};</span>

<span class="nc bnc" id="L127" title="All 2 branches missed.">                for (int i = 0; i &lt; boxes.length; i++) {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">                    if (boxes[i].contains(temp_x, temp_y)) {</span>
<span class="nc" id="L129">                        this.returnCode = pos[i];</span>
<span class="nc" id="L130">                        this.isRunning = false;</span>
<span class="nc" id="L131">                        break;</span>
                    }
                }
            }
        }
<span class="nc" id="L136">    }</span>

	/**
	 * Shifts the focus to the next menu item. - modified for 2P mode selection
	 */
	private void nextMenuItem() {
<span class="nc" id="L142">        this.menuIndex = (this.menuIndex + 1) % 5;</span>
<span class="nc" id="L143">        drawManager.getTitleScreenRenderer().menuHover(this.menuIndex);</span>
<span class="nc" id="L144">	}</span>

	/**
	 * Shifts the focus to the previous menu item.
	 */
	private void previousMenuItem() {
<span class="nc" id="L150">        this.menuIndex = (this.menuIndex + 4) % 5; // Fix : an issue where only the down arrow keys on the keyboard are entered and not up</span>
<span class="nc" id="L151">        drawManager.getTitleScreenRenderer().menuHover(this.menuIndex);</span>
<span class="nc" id="L152">    }</span>
	/**
	 * Draws the elements associated with the screen.
	 */

	/** Check hover based on mouse position and menu hitbox. */
	private void draw() {
<span class="nc" id="L159">		drawManager.initDrawing(this);</span>

        // Main menu space animation
<span class="nc" id="L162">        drawManager.getTitleScreenRenderer().updateMenuSpace(drawManager.getBackBufferGraphics());</span>

<span class="nc" id="L164">		int mx = inputManager.getMouseX();</span>
<span class="nc" id="L165">		int my = inputManager.getMouseY();</span>
<span class="nc" id="L166">		java.awt.Rectangle[] boxesForHover = Core.getHitboxManager().getMenuHitboxes(drawManager.getBackBufferGraphics(), this);</span>

<span class="nc" id="L168">		Integer newHover = null;</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">		if(boxesForHover[0].contains(mx, my)) {</span>
<span class="nc" id="L170">            newHover = 0;</span>
<span class="nc" id="L171">            drawManager.getTitleScreenRenderer().menuHover(0);</span>
        }
<span class="nc bnc" id="L173" title="All 2 branches missed.">		if(boxesForHover[1].contains(mx, my)){</span>
<span class="nc" id="L174">            newHover = 1;</span>
<span class="nc" id="L175">            drawManager.getTitleScreenRenderer().menuHover(1);</span>
        }
<span class="nc bnc" id="L177" title="All 2 branches missed.">		if(boxesForHover[2].contains(mx, my)){</span>
<span class="nc" id="L178">            newHover = 2;</span>
<span class="nc" id="L179">            drawManager.getTitleScreenRenderer().menuHover(2);</span>
        }
<span class="nc bnc" id="L181" title="All 2 branches missed.">        if(boxesForHover[3].contains(mx, my)){</span>
<span class="nc" id="L182">            newHover = 3;</span>
<span class="nc" id="L183">            drawManager.getTitleScreenRenderer().menuHover(3);</span>
        }
<span class="nc bnc" id="L185" title="All 2 branches missed.">        if(boxesForHover[4].contains(mx, my)){</span>
<span class="nc" id="L186">            newHover = 4;</span>
<span class="nc" id="L187">            drawManager.getTitleScreenRenderer().menuHover(4);</span>
        }

        // Modify : Update after hover calculation
<span class="nc bnc" id="L191" title="All 2 branches missed.">        if (newHover != null) {</span>
            // Hover Update + Promote to Select Index when mouse is raised (to keep mouse away)
<span class="nc bnc" id="L193" title="All 2 branches missed.">            if (!newHover.equals(this.hoverOption)) { this.hoverOption = newHover; }</span>
        } else {
            // If we had a hover and the mouse left, promote last hover to selection for persistance
<span class="nc bnc" id="L196" title="All 2 branches missed.">            if (this.hoverOption != null) {</span>
<span class="nc" id="L197">                this.menuIndex = this.hoverOption; // persist last hovered as selection</span>
<span class="nc" id="L198">                this.hoverOption = null; // clear hover state</span>
            }

        }

		//pass hoverOption for menu highlights respond to mouse hover
<span class="nc" id="L204">		drawManager.getTitleScreenRenderer().drawTitle(drawManager.getBackBufferGraphics(), this);</span>
<span class="nc" id="L205">		drawManager.getTitleScreenRenderer().drawMenu(drawManager.getBackBufferGraphics(), this, this.menuIndex, hoverOption, this.menuIndex); // 2P mode: using menu index for highlighting</span>

<span class="nc" id="L207">		drawManager.completeDrawing(this);</span>
<span class="nc" id="L208">	}</span>

    public boolean isCoopSelected() {
<span class="nc" id="L211">        return coopSelected;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>