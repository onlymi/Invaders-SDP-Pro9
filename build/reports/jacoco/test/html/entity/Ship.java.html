<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Ship.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">space_Invaders</a> &gt; <a href="index.source.html" class="el_package">entity</a> &gt; <span class="el_source">Ship.java</span></div><h1>Ship.java</h1><pre class="source lang-java linenums">package entity;

import java.awt.Color;
import java.util.Set;

import engine.utils.Cooldown;
import engine.Core;
import engine.GameState;
import engine.AssetManager.SpriteType;
import static engine.gameplay.item.ItemEffect.*;

/**
 * Implements a ship, to be controlled by the player.
 *
 * @author &lt;a href=&quot;mailto:RobertoIA1987@gmail.com&quot;&gt;Roberto Izquierdo Amo&lt;/a&gt;
 *
 */
public class Ship extends Entity {

    /** Bullet Variables **/
    //default bullet variables
    private static final int BASE_BULLET_SPEED = -6;
    private static final int BASE_SHOOTING_INTERVAL = 750;
    private static final int BASE_BULLET_WIDTH = 6;  // 3 * 2
    private static final int BASE_BULLET_HEIGHT = 10;
    // special bullet variables
    private static final int DOUBLE_SHOT_OFFSET = 6;

    /** Ship Variables **/
    private static final int BASE_SPEED = 2;
    private static final int SHIP_WIDTH = 26;  // 13 * 2
    private static final int SHIP_HEIGHT = 16;
    private static final int DESTRUCTION_COOLDOWN = 1000;

    /** Types of ships. */
<span class="fc" id="L36">    public enum ShipType {</span>
<span class="fc" id="L37">        NORMAL,         // Bullet size is normal, and moving speed is normal.</span>
<span class="fc" id="L38">        BIG_SHOT,       // Bullet size is big, but moving speed is slow.</span>
<span class="fc" id="L39">        DOUBLE_SHOT,    // Double shot, but moving speed is slow.</span>
<span class="fc" id="L40">        MOVE_FAST       // Moving speed is fast, but fire rate is slow.</span>
    }

    /** Game state and Ship type **/
    private GameState gameState;
    private ShipType type;

    // Ship properties (vary by type)
<span class="fc" id="L48">    private int moveSpeed = BASE_SPEED;</span>
<span class="fc" id="L49">    private int bulletSpeed = BASE_BULLET_SPEED;</span>
<span class="fc" id="L50">    private int shootingInterval = BASE_SHOOTING_INTERVAL;</span>
<span class="fc" id="L51">    private int bulletWidth = BASE_BULLET_WIDTH;</span>
<span class="fc" id="L52">    private int bulletHeight = BASE_BULLET_HEIGHT;</span>

    /** Cooldowns */
    private Cooldown shootingCooldown;
    private Cooldown destructionCooldown;

    // Identify player in index: 0 = P1, 1 = P2
<span class="fc" id="L59">    private int playerIndex = 0;</span>

    private int Y;
    private int hits;

    /**
     * Constructor, establishes the ship's properties.
     *
     * @param positionX
     *                  Initial position of the ship in the X axis.
     * @param positionY
     *                  Initial position of the ship in the Y axis.
     * @param team
     *                  Player team (null defaults to PLAYER1)
     * @param type
     *                  Ship type (null defaults to NORMAL)
     * @param gameState
     *                  Game state reference (can be null)
     */
    public Ship(final int positionX, final int positionY, final Team team,
                final ShipType type, final GameState gameState) {
<span class="fc" id="L80">        super(positionX, positionY, SHIP_WIDTH, SHIP_HEIGHT, Color.GREEN);</span>

<span class="fc" id="L82">        this.gameState = gameState;</span>
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">        this.type = (type != null) ? type : ShipType.NORMAL;</span>
<span class="fc" id="L84">        this.spriteType = SpriteType.Ship1;</span>

<span class="fc" id="L86">        initializeShipProperties(this.type);</span>

<span class="fc" id="L88">        this.shootingCooldown = Core.getCooldown(this.shootingInterval);</span>
<span class="fc" id="L89">        this.destructionCooldown = Core.getCooldown(DESTRUCTION_COOLDOWN);</span>

        // apply entity
<span class="pc bpc" id="L92" title="1 of 2 branches missed.">        Team playerID = (team != null) ? team : Team.PLAYER1;</span>
<span class="fc" id="L93">        this.setTeam(playerID);</span>
<span class="pc bpc" id="L94" title="3 of 4 branches missed.">        this.playerIndex = (playerID == Team.PLAYER1) ? 0 : (playerID == Team.PLAYER2) ? 1 : 0;</span>

<span class="fc" id="L96">        this.Y = positionY;</span>
<span class="fc" id="L97">        this.hits = 0;</span>
<span class="fc" id="L98">    }</span>

    /**
     * Initializes ship properties based on ship type.
     *
     * @param type Ship type to configure
     */
    private void initializeShipProperties(final ShipType type) {
<span class="fc" id="L106">        this.bulletSpeed = BASE_BULLET_SPEED;</span>

<span class="pc bpc" id="L108" title="1 of 4 branches missed.">        switch (type) {</span>
            case BIG_SHOT:
<span class="fc" id="L110">                this.moveSpeed -= 1;</span>
<span class="fc" id="L111">                this.bulletWidth = 9;  // 3 * 3</span>
<span class="fc" id="L112">                this.bulletHeight = 15; // 5 * 3</span>
<span class="fc" id="L113">                this.spriteType = SpriteType.Ship2;</span>
<span class="fc" id="L114">                break;</span>
            case DOUBLE_SHOT:
<span class="nc" id="L116">                this.moveSpeed -= 1;</span>
<span class="nc" id="L117">                this.spriteType = SpriteType.Ship3;</span>
<span class="nc" id="L118">                break;</span>
            case MOVE_FAST:
<span class="fc" id="L120">                this.moveSpeed += 1;</span>
<span class="fc" id="L121">                this.shootingInterval += 150;</span>
<span class="fc" id="L122">                this.spriteType = SpriteType.Ship4;</span>
<span class="fc" id="L123">                break;</span>
            case NORMAL:
            default:
                break;
        }
<span class="fc" id="L128">    }</span>

    /**
     * Moves the ship speed uni ts right, or until the right screen border is reached.
     */
<span class="nc" id="L133">    public final void moveRight() { this.positionX += this.moveSpeed; }</span>

    /**
     * Moves the ship speed units left, or until the left screen border is reached.
     */
    public final void moveLeft() {
<span class="nc" id="L139">        this.positionX -= this.moveSpeed;</span>
<span class="nc" id="L140">    }</span>

    /**
     * Shoots a bullet based on ship type and active effects.
     *
     * @param bullets
     *                List of bullets on screen, to add the new bullet.
     * @return
     *                True if shooting was successful, false if on cooldown
     */
    public final boolean shoot(final Set&lt;Bullet&gt; bullets) {

<span class="nc bnc" id="L152" title="All 2 branches missed.">        if (!this.shootingCooldown.checkFinished()) { return false; }</span>

<span class="nc" id="L154">        this.shootingCooldown.reset();</span>
<span class="nc" id="L155">        Core.getLogger().info(&quot;[Ship] Shooting :&quot; + this.type);</span>

<span class="nc" id="L157">        int bulletX = positionX + this.width / 2;</span>
<span class="nc" id="L158">        int bulletY = this.positionY - this.bulletHeight;</span>

<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (hasTripleShotEffect()) {</span>
<span class="nc" id="L161">            shootTripleShot(bullets, bulletX, bulletY);</span>
<span class="nc" id="L162">            return true;</span>
        }

        // Default shooting based on ship type
<span class="nc" id="L166">        shootBasedOnType(bullets, bulletX, bulletY);</span>
<span class="nc" id="L167">        return true;</span>
    }

    /**
     * Updates status of the ship.
     */
    public final void update() {
<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (!this.destructionCooldown.checkFinished())</span>
<span class="nc bnc" id="L175" title="All 5 branches missed.">            switch (this.spriteType) {</span>
<span class="nc" id="L176">                case Ship1 -&gt; this.spriteType = SpriteType.ShipDestroyed1;</span>
<span class="nc" id="L177">                case Ship2 -&gt; this.spriteType = SpriteType.ShipDestroyed2;</span>
<span class="nc" id="L178">                case Ship3 -&gt; this.spriteType = SpriteType.ShipDestroyed3;</span>
<span class="nc" id="L179">                case Ship4 -&gt; this.spriteType = SpriteType.ShipDestroyed4;</span>
            }
        else
<span class="nc bnc" id="L182" title="All 5 branches missed.">            switch (this.spriteType) {</span>
<span class="nc" id="L183">                case ShipDestroyed1 -&gt; this.spriteType = SpriteType.Ship1;</span>
<span class="nc" id="L184">                case ShipDestroyed2 -&gt; this.spriteType = SpriteType.Ship2;</span>
<span class="nc" id="L185">                case ShipDestroyed3 -&gt; this.spriteType = SpriteType.Ship3;</span>
<span class="nc" id="L186">                case ShipDestroyed4 -&gt; this.spriteType = SpriteType.Ship4;</span>
        }
<span class="nc" id="L188">    }</span>

    /**
     * Switches the ship to its destroyed state.
     */
    public final void destroy() {
<span class="nc" id="L194">        this.destructionCooldown.reset();</span>
<span class="nc" id="L195">    }</span>

    /**
     * Checks if the ship is destroyed.
     *
     * @return True if the ship is currently destroyed.
     */
    public final boolean isDestroyed() {
<span class="nc bnc" id="L203" title="All 2 branches missed.">        return !this.destructionCooldown.checkFinished();</span>
    }

    /**
     * Getter for the ship's speed.
     *
     * @return Speed of the ship.
     */
<span class="fc" id="L211">    public final int getSpeed() { return this.moveSpeed; }</span>

    // 2P mode: adding playerIndex getter and setter
<span class="nc" id="L214">    public final int getPlayerId() { return this.playerIndex + 1; }</span>

<span class="nc" id="L216">    public void setPlayerId(int id) { this.playerIndex = id -1; }</span>


    /**
     * Fires bullets based on ship type.
     */
    private void shootBasedOnType(final Set&lt;Bullet&gt; bullets, final int centerX, final int bulletY) {
<span class="nc bnc" id="L223" title="All 2 branches missed.">        switch (this.type) {</span>
            case DOUBLE_SHOT:
<span class="nc" id="L225">                addBullet(bullets, centerX - DOUBLE_SHOT_OFFSET, bulletY);</span>
<span class="nc" id="L226">                addBullet(bullets, centerX + DOUBLE_SHOT_OFFSET, bulletY);</span>
<span class="nc" id="L227">                break;</span>
            case BIG_SHOT:
            case MOVE_FAST:
            case NORMAL:
            default:
<span class="nc" id="L232">                addBullet(bullets, centerX, bulletY);</span>
                break;
        }
<span class="nc" id="L235">    }</span>

    /**
     * Creates and adds a bullet to the game.
     */
    private void addBullet(final Set&lt;Bullet&gt; bullets, final int x, final int y) {
<span class="nc" id="L241">        int speedMultiplier = getBulletSpeedMultiplier();</span>
<span class="nc" id="L242">        int currentBulletSpeed = this.bulletSpeed * speedMultiplier;</span>

<span class="nc" id="L244">        Bullet bullet = BulletPool.getBullet(x, y, currentBulletSpeed,</span>
<span class="nc" id="L245">                this.bulletWidth, this.bulletHeight, this.getTeam());</span>
<span class="nc" id="L246">        bullet.setOwnerPlayerId(this.getPlayerId());</span>
<span class="nc" id="L247">        bullets.add(bullet);</span>
<span class="nc" id="L248">    }</span>

    /** ========================= Item Effect check ========================= **/

    /**
     * Checks if player has effect active
     *
     * @return
     *                              list of active effects
     */
    private boolean hasTripleShotEffect() {
<span class="nc bnc" id="L259" title="All 4 branches missed.">        return gameState != null &amp;&amp; gameState.hasEffect(playerIndex, ItemEffectType.TRIPLESHOT);</span>
    }

    private int getBulletSpeedMultiplier() {
<span class="nc bnc" id="L263" title="All 2 branches missed.">        if (gameState == null) return 1;</span>

<span class="nc" id="L265">        Integer effectValue = gameState.getEffectValue(playerIndex, ItemEffectType.BULLETSPEEDUP);</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (effectValue != null) {</span>
<span class="nc" id="L267">            Core.getLogger().info(&quot;[Ship] Item effect: Faster Bullets&quot;);</span>
<span class="nc" id="L268">            return effectValue;</span>
        }
<span class="nc" id="L270">        return 1;</span>
    }

    public void addHit(){
<span class="nc" id="L274">        this.hits++;</span>
<span class="nc" id="L275">    }</span>

    /**
     * TRIPLESHOT effect
     */
    private void shootTripleShot(final Set&lt;Bullet&gt; bullets, final int centerX, final int bulletY) {
<span class="nc" id="L281">        Core.getLogger().info(&quot;[Ship] Item effect: TRIPLESHOT&quot;);</span>
<span class="nc" id="L282">        Integer TRIPLE_SHOT_OFFSET = gameState.getEffectValue(playerIndex, ItemEffectType.TRIPLESHOT);</span>

<span class="nc" id="L284">        addBullet(bullets, centerX, bulletY);</span>
<span class="nc" id="L285">        addBullet(bullets, centerX - TRIPLE_SHOT_OFFSET, bulletY);</span>
<span class="nc" id="L286">        addBullet(bullets, centerX + TRIPLE_SHOT_OFFSET, bulletY);</span>
<span class="nc" id="L287">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>