<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ko"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EnemyShipFormation.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">space_Invaders</a> &gt; <a href="index.source.html" class="el_package">entity</a> &gt; <span class="el_source">EnemyShipFormation.java</span></div><h1>EnemyShipFormation.java</h1><pre class="source lang-java linenums">package entity;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Set;
import java.util.logging.Logger;

import engine.*;
import engine.utils.Cooldown;
import screen.Screen;
import engine.AssetManager.SpriteType;

/**
 * Groups enemy ships into a formation that moves together.
 *
 * @author &lt;a href=&quot;mailto:RobertoIA1987@gmail.com&quot;&gt;Roberto Izquierdo Amo&lt;/a&gt;
 *
 */
public class EnemyShipFormation implements Iterable&lt;EnemyShip&gt; {

    /** Initial position in the x-axis. */
    private static final int INIT_POS_X = 20;
    /** Initial position in the y-axis. */
    private static final int INIT_POS_Y = 100;
    /** Distance between ships. */
    private static final int SEPARATION_DISTANCE = 40;
    /** Proportion of C-type ships. */
    private static final double PROPORTION_C = 0.2;
    /** Proportion of B-type ships. */
    private static final double PROPORTION_B = 0.4;
    /** Lateral speed of the formation. */
    private static final int X_SPEED = 8;
    /** Downwards speed of the formation. */
    private static final int Y_SPEED = 4;
    /** Speed of the bullets shot by the members. */
    private static final int BULLET_SPEED = 4;
    /** Proportion of differences between shooting times. */
    private static final double SHOOTING_VARIANCE = .2;
    /** Margin on the sides of the screen. */
    private static final int SIDE_MARGIN = 20;
    /** Margin on the bottom of the screen. */
    private static final int BOTTOM_MARGIN = 80;
    /** Distance to go down each pass. */
    private static final int DESCENT_DISTANCE = 20;
    /** Minimum speed allowed. */
    private static final int MINIMUM_SPEED = 10;

    /** DrawManager instance. */
    private DrawManager drawManager;
    /** Application logger. */
    private Logger logger;
    /** Screen to draw ships on. */
    private Screen screen;

    /** List of enemy ships forming the formation. */
    private List&lt;List&lt;EnemyShip&gt;&gt; enemyShips;
    /** Minimum time between shots. */
    private Cooldown shootingCooldown;
    /** Number of ships in the formation - horizontally. */
    private int nShipsWide;
    /** Number of ships in the formation - vertically. */
    private int nShipsHigh;
    /** Time between shots. */
    private int shootingInterval;
    /** Variance in the time between shots. */
    private int shootingVariance;
    /** Initial ship speed. */
    private int baseSpeed;
    /** Speed of the ships. */
    private int movementSpeed;
    /** Current direction the formation is moving on. */
    private Direction currentDirection;
    /** Direction the formation was moving previously. */
    private Direction previousDirection;
    /** Interval between movements, in frames. */
    private int movementInterval;
    /** Total width of the formation. */
    private int width;
    /** Total height of the formation. */
    private int height;
    /** Position in the x-axis of the upper left corner of the formation. */
    private int positionX;
    /** Position in the y-axis of the upper left corner of the formation. */
    private int positionY;
    /** Width of one ship. */
    private int shipWidth;
    /** Height of one ship. */
    private int shipHeight;
    /** List of ships that are able to shoot. */
    private List&lt;EnemyShip&gt; shooters;
    /** Number of not destroyed ships. */
    private int shipCount;

    /** Directions the formation can move. */
<span class="nc" id="L97">    private enum Direction {</span>
        /** Movement to the right side of the screen. */
<span class="nc" id="L99">        RIGHT,</span>
        /** Movement to the left side of the screen. */
<span class="nc" id="L101">        LEFT,</span>
        /** Movement to the bottom of the screen. */
<span class="nc" id="L103">        DOWN</span>
    };

    /**
     * Constructor, sets the initial conditions.
     *
     * @param gameSettings
     *            Current game settings.
     */
<span class="nc" id="L112">    public EnemyShipFormation(final GameSettings gameSettings) {</span>
<span class="nc" id="L113">        this.drawManager = Core.getDrawManager();</span>
<span class="nc" id="L114">        this.logger = Core.getLogger();</span>
<span class="nc" id="L115">        this.enemyShips = new ArrayList&lt;List&lt;EnemyShip&gt;&gt;();</span>
<span class="nc" id="L116">        this.currentDirection = Direction.RIGHT;</span>
<span class="nc" id="L117">        this.movementInterval = 0;</span>
<span class="nc" id="L118">        this.nShipsWide = gameSettings.getFormationWidth();</span>
<span class="nc" id="L119">        this.nShipsHigh = gameSettings.getFormationHeight();</span>
<span class="nc" id="L120">        this.shootingInterval = gameSettings.getShootingFrequency();</span>
<span class="nc" id="L121">        this.shootingVariance = (int) (gameSettings.getShootingFrequency()</span>
                * SHOOTING_VARIANCE);
<span class="nc" id="L123">        this.baseSpeed = gameSettings.getBaseSpeed();</span>
<span class="nc" id="L124">        this.movementSpeed = this.baseSpeed;</span>
<span class="nc" id="L125">        this.positionX = INIT_POS_X;</span>
<span class="nc" id="L126">        this.positionY = INIT_POS_Y;</span>
<span class="nc" id="L127">        this.shooters = new ArrayList&lt;EnemyShip&gt;();</span>
        SpriteType spriteType;

<span class="nc" id="L130">        this.logger.info(&quot;Initializing &quot; + nShipsWide + &quot;x&quot; + nShipsHigh</span>
                + &quot; ship formation in (&quot; + positionX + &quot;,&quot; + positionY + &quot;)&quot;);

        // Each sub-list is a column on the formation.
<span class="nc bnc" id="L134" title="All 2 branches missed.">        for (int i = 0; i &lt; this.nShipsWide; i++)</span>
<span class="nc" id="L135">            this.enemyShips.add(new ArrayList&lt;EnemyShip&gt;());</span>

<span class="nc bnc" id="L137" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips) {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            for (int i = 0; i &lt; this.nShipsHigh; i++) {</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">                if (i / (float) this.nShipsHigh &lt; PROPORTION_C)</span>
<span class="nc" id="L140">                    spriteType = SpriteType.EnemyShipC1;</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">                else if (i / (float) this.nShipsHigh &lt; PROPORTION_B</span>
                        + PROPORTION_C)
<span class="nc" id="L143">                    spriteType = SpriteType.EnemyShipB1;</span>
                else
<span class="nc" id="L145">                    spriteType = SpriteType.EnemyShipA1;</span>

<span class="nc" id="L147">                column.add(new EnemyShip((SEPARATION_DISTANCE</span>
<span class="nc" id="L148">                        * this.enemyShips.indexOf(column))</span>
                        + positionX, (SEPARATION_DISTANCE * i)
                        + positionY, spriteType));
<span class="nc" id="L151">                this.shipCount++;</span>
            }
<span class="nc" id="L153">        }</span>

<span class="nc" id="L155">        this.shipWidth = this.enemyShips.get(0).get(0).getWidth();</span>
<span class="nc" id="L156">        this.shipHeight = this.enemyShips.get(0).get(0).getHeight();</span>

<span class="nc" id="L158">        this.width = (this.nShipsWide - 1) * SEPARATION_DISTANCE</span>
                + this.shipWidth;
<span class="nc" id="L160">        this.height = (this.nShipsHigh - 1) * SEPARATION_DISTANCE</span>
                + this.shipHeight;

<span class="nc bnc" id="L163" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips)</span>
<span class="nc" id="L164">            this.shooters.add(column.get(column.size() - 1));</span>

<span class="nc bnc" id="L166" title="All 2 branches missed.">        for (GameSettings.ChangeData changeData : gameSettings.getChangeDataList()){</span>
<span class="nc" id="L167">            EnemyShip ship = this.enemyShips.get(changeData.x).get(changeData.y);</span>

<span class="nc bnc" id="L169" title="All 2 branches missed.">            if(changeData.hp == 0){</span>
<span class="nc" id="L170">                destroy(ship);</span>
            }
            else {
<span class="nc" id="L173">                ship.changeShip(changeData);</span>
            }
<span class="nc" id="L175">        }</span>

        List&lt;EnemyShip&gt; destroyed;
<span class="nc bnc" id="L178" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips) {</span>
<span class="nc" id="L179">            destroyed = new ArrayList&lt;EnemyShip&gt;();</span>
<span class="nc bnc" id="L180" title="All 2 branches missed.">            for (EnemyShip ship : column) {</span>
<span class="nc bnc" id="L181" title="All 4 branches missed.">                if (ship != null &amp;&amp; ship.isDestroyed()) {</span>
<span class="nc" id="L182">                    destroyed.add(ship);</span>
<span class="nc" id="L183">                    this.logger.info(&quot;Removed enemy &quot;</span>
<span class="nc" id="L184">                            + column.indexOf(ship) + &quot; from column &quot;</span>
<span class="nc" id="L185">                            + this.enemyShips.indexOf(column));</span>
                }
<span class="nc" id="L187">            }</span>
<span class="nc" id="L188">            column.removeAll(destroyed);</span>
<span class="nc" id="L189">        }</span>
<span class="nc" id="L190">    }</span>

    /**
     * Associates the formation to a given screen.
     *
     * @param newScreen
     *            Screen to attach.
     */
    public final void attach(final Screen newScreen) {
<span class="nc" id="L199">        screen = newScreen;</span>
<span class="nc" id="L200">    }</span>

    /**
     * Draws every individual component of the formation.
     */
    public final void draw() {
<span class="nc bnc" id="L206" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips)</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">            for (EnemyShip enemyShip : column)</span>
<span class="nc" id="L208">                drawManager.getEntityRenderer().drawEntity(drawManager.getBackBufferGraphics(), enemyShip, enemyShip.getPositionX(),</span>
<span class="nc" id="L209">                        enemyShip.getPositionY());</span>
<span class="nc" id="L210">    }</span>

    /**
     * Updates the position of the ships.
     */
    public final void update() {
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if(this.shootingCooldown == null) {</span>
<span class="nc" id="L217">            this.shootingCooldown = Core.getVariableCooldown(shootingInterval,</span>
                    shootingVariance);
<span class="nc" id="L219">            this.shootingCooldown.reset();</span>
        }

<span class="nc" id="L222">        cleanUp();</span>

<span class="nc" id="L224">        int movementX = 0;</span>
<span class="nc" id="L225">        int movementY = 0;</span>
<span class="nc" id="L226">        double remainingProportion = (double) this.shipCount</span>
                / (this.nShipsHigh * this.nShipsWide);
<span class="nc" id="L228">        this.movementSpeed = (int) (Math.pow(remainingProportion, 2)</span>
                * this.baseSpeed);
<span class="nc" id="L230">        this.movementSpeed += MINIMUM_SPEED;</span>

<span class="nc" id="L232">        movementInterval++;</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">        if (movementInterval &gt;= this.movementSpeed) {</span>
<span class="nc" id="L234">            movementInterval = 0;</span>

<span class="nc" id="L236">            boolean isAtBottom = positionY</span>
<span class="nc bnc" id="L237" title="All 2 branches missed.">                    + this.height &gt; screen.getHeight() - BOTTOM_MARGIN;</span>
<span class="nc" id="L238">            boolean isAtRightSide = positionX</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">                    + this.width &gt;= screen.getWidth() - SIDE_MARGIN;</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">            boolean isAtLeftSide = positionX &lt;= SIDE_MARGIN;</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">            boolean isAtHorizontalAltitude = positionY % DESCENT_DISTANCE == 0;</span>

<span class="nc bnc" id="L243" title="All 2 branches missed.">            if (currentDirection == Direction.DOWN) {</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">                if (isAtHorizontalAltitude)</span>
<span class="nc bnc" id="L245" title="All 2 branches missed.">                    if (previousDirection == Direction.RIGHT) {</span>
<span class="nc" id="L246">                        currentDirection = Direction.LEFT;</span>
<span class="nc" id="L247">                        this.logger.info(&quot;Formation now moving left 1&quot;);</span>
                    } else {
<span class="nc" id="L249">                        currentDirection = Direction.RIGHT;</span>
<span class="nc" id="L250">                        this.logger.info(&quot;Formation now moving right 2&quot;);</span>
                    }
<span class="nc bnc" id="L252" title="All 2 branches missed.">            } else if (currentDirection == Direction.LEFT) {</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">                if (isAtLeftSide)</span>
<span class="nc bnc" id="L254" title="All 2 branches missed.">                    if (!isAtBottom) {</span>
<span class="nc" id="L255">                        previousDirection = currentDirection;</span>
<span class="nc" id="L256">                        currentDirection = Direction.DOWN;</span>
<span class="nc" id="L257">                        this.logger.info(&quot;Formation now moving down 3&quot;);</span>
                    } else {
<span class="nc" id="L259">                        currentDirection = Direction.RIGHT;</span>
<span class="nc" id="L260">                        this.logger.info(&quot;Formation now moving right 4&quot;);</span>
                    }
            } else {
<span class="nc bnc" id="L263" title="All 2 branches missed.">                if (isAtRightSide)</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">                    if (!isAtBottom) {</span>
<span class="nc" id="L265">                        previousDirection = currentDirection;</span>
<span class="nc" id="L266">                        currentDirection = Direction.DOWN;</span>
<span class="nc" id="L267">                        this.logger.info(&quot;Formation now moving down 5&quot;);</span>
                    } else {
<span class="nc" id="L269">                        currentDirection = Direction.LEFT;</span>
<span class="nc" id="L270">                        this.logger.info(&quot;Formation now moving left 6&quot;);</span>
                    }
            }

<span class="nc bnc" id="L274" title="All 2 branches missed.">            if (currentDirection == Direction.RIGHT)</span>
<span class="nc" id="L275">                movementX = X_SPEED;</span>
<span class="nc bnc" id="L276" title="All 2 branches missed.">            else if (currentDirection == Direction.LEFT)</span>
<span class="nc" id="L277">                movementX = -X_SPEED;</span>
            else
<span class="nc" id="L279">                movementY = Y_SPEED;</span>

<span class="nc" id="L281">            positionX += movementX;</span>
<span class="nc" id="L282">            positionY += movementY;</span>

            // Cleans explosions.
            List&lt;EnemyShip&gt; destroyed;
<span class="nc bnc" id="L286" title="All 2 branches missed.">            for (List&lt;EnemyShip&gt; column : this.enemyShips) {</span>
<span class="nc" id="L287">                destroyed = new ArrayList&lt;EnemyShip&gt;();</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">                for (EnemyShip ship : column) {</span>
<span class="nc bnc" id="L289" title="All 4 branches missed.">                    if (ship != null &amp;&amp; ship.isDestroyed()) {</span>
<span class="nc" id="L290">                        destroyed.add(ship);</span>
<span class="nc" id="L291">                        this.logger.info(&quot;Removed enemy &quot;</span>
<span class="nc" id="L292">                                + column.indexOf(ship) + &quot; from column &quot;</span>
<span class="nc" id="L293">                                + this.enemyShips.indexOf(column));</span>
                    }
<span class="nc" id="L295">                }</span>
<span class="nc" id="L296">                column.removeAll(destroyed);</span>
<span class="nc" id="L297">            }</span>

<span class="nc bnc" id="L299" title="All 2 branches missed.">            for (List&lt;EnemyShip&gt; column : this.enemyShips)</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">                for (EnemyShip enemyShip : column) {</span>
<span class="nc" id="L301">                    enemyShip.move(movementX, movementY);</span>
<span class="nc" id="L302">                    enemyShip.update();</span>
<span class="nc" id="L303">                }</span>
        }
<span class="nc" id="L305">    }</span>

    /**
     * Cleans empty columns, adjusts the width and height of the formation.
     */
    private void cleanUp() {
<span class="nc" id="L311">        Set&lt;Integer&gt; emptyColumns = new HashSet&lt;Integer&gt;();</span>
<span class="nc" id="L312">        int maxColumn = 0;</span>
<span class="nc" id="L313">        int minPositionY = Integer.MAX_VALUE;</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips) {</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">            if (!column.isEmpty()) {</span>
                // Height of this column
<span class="nc" id="L317">                int columnSize = column.get(column.size() - 1).positionY</span>
                        - this.positionY + this.shipHeight;
<span class="nc" id="L319">                maxColumn = Math.max(maxColumn, columnSize);</span>
<span class="nc" id="L320">                minPositionY = Math.min(minPositionY, column.get(0)</span>
<span class="nc" id="L321">                        .getPositionY());</span>
<span class="nc" id="L322">            } else {</span>
                // Empty column, we remove it.
<span class="nc" id="L324">                emptyColumns.add(this.enemyShips.indexOf(column));</span>
            }
<span class="nc" id="L326">        }</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">        for (int index : emptyColumns) {</span>
<span class="nc" id="L328">            this.enemyShips.remove(index);</span>
<span class="nc" id="L329">            logger.info(&quot;Removed column &quot; + index);</span>
<span class="nc" id="L330">        }</span>

<span class="nc" id="L332">        int leftMostPoint = 0;</span>
<span class="nc" id="L333">        int rightMostPoint = 0;</span>

<span class="nc bnc" id="L335" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips) {</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">            if (!column.isEmpty()) {</span>
<span class="nc bnc" id="L337" title="All 2 branches missed.">                if (leftMostPoint == 0)</span>
<span class="nc" id="L338">                    leftMostPoint = column.get(0).getPositionX();</span>
<span class="nc" id="L339">                rightMostPoint = column.get(0).getPositionX();</span>
            }
<span class="nc" id="L341">        }</span>

<span class="nc" id="L343">        this.width = rightMostPoint - leftMostPoint + this.shipWidth;</span>
<span class="nc" id="L344">        this.height = maxColumn;</span>

<span class="nc" id="L346">        this.positionX = leftMostPoint;</span>
<span class="nc" id="L347">        this.positionY = minPositionY;</span>
<span class="nc" id="L348">    }</span>

    /**
     * Shoots a bullet downwards.
     * Fires bullets from C-type and B-type enemies in the formation.
     * C-type fires double bullets, B-type fires faster bullets.
     *
     * @param bullets
     *            Bullets set to add the bullet being shot.
     */
    public final void shoot(final Set&lt;Bullet&gt; bullets) {
<span class="nc bnc" id="L359" title="All 2 branches missed.">        if (this.shooters.isEmpty()) return;</span>

<span class="nc" id="L361">        int index = (int) (Math.random() * this.shooters.size());</span>
<span class="nc" id="L362">        EnemyShip shooter = this.shooters.get(index);</span>

<span class="nc bnc" id="L364" title="All 2 branches missed.">        if (this.shootingCooldown.checkFinished()) {</span>
<span class="nc" id="L365">            this.shootingCooldown.reset();</span>

<span class="nc" id="L367">            int bulletWidth = 3 * 2;</span>
<span class="nc" id="L368">            int bulletHeight = 5 * 2;</span>
<span class="nc" id="L369">            int spawnY = shooter.getPositionY() + shooter.getHeight();</span>

<span class="nc" id="L371">            int bulletSpeed = BULLET_SPEED;</span>

<span class="nc bnc" id="L373" title="All 2 branches missed.">            if (shooter.getSpriteType() == SpriteType.EnemyShipB1</span>
<span class="nc bnc" id="L374" title="All 2 branches missed.">                    || shooter.getSpriteType() == SpriteType.EnemyShipB2) {</span>
<span class="nc" id="L375">                bulletSpeed = BULLET_SPEED * 2;</span>
            }

<span class="nc bnc" id="L378" title="All 2 branches missed.">            if (shooter.getSpriteType() == SpriteType.EnemyShipC1</span>
<span class="nc bnc" id="L379" title="All 2 branches missed.">                    || shooter.getSpriteType() == SpriteType.EnemyShipC2) {</span>
<span class="nc" id="L380">                int offset = 6;</span>

<span class="nc" id="L382">                Bullet b1 = BulletPool.getBullet(</span>
<span class="nc" id="L383">                        shooter.getPositionX() + shooter.getWidth() / 2 - offset,</span>
                        spawnY, bulletSpeed, bulletWidth, bulletHeight, Entity.Team.ENEMY);
<span class="nc" id="L385">                bullets.add(b1);</span>

<span class="nc" id="L387">                Bullet b2 = BulletPool.getBullet(</span>
<span class="nc" id="L388">                        shooter.getPositionX() + shooter.getWidth() / 2 + offset,</span>
                        spawnY, bulletSpeed, bulletWidth, bulletHeight, Entity.Team.ENEMY);
<span class="nc" id="L390">                bullets.add(b2);</span>

<span class="nc" id="L392">            } else {</span>
<span class="nc" id="L393">                Bullet b = BulletPool.getBullet(</span>
<span class="nc" id="L394">                        shooter.getPositionX() + shooter.getWidth() / 2,</span>
                        spawnY, bulletSpeed, bulletWidth, bulletHeight, Entity.Team.ENEMY);
<span class="nc" id="L396">                bullets.add(b);</span>
            }
        }
<span class="nc" id="L399">    }</span>

    /**
     * Destroys a ship.
     *
     * @param destroyedShip
     *            Ship to be destroyed.
     */
    public final void destroy(final EnemyShip destroyedShip) {
<span class="nc bnc" id="L408" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips)</span>
<span class="nc bnc" id="L409" title="All 2 branches missed.">            for (int i = 0; i &lt; column.size(); i++)</span>
<span class="nc bnc" id="L410" title="All 2 branches missed.">                if (column.get(i).equals(destroyedShip)) {</span>
<span class="nc" id="L411">                    column.get(i).destroy();</span>
<span class="nc" id="L412">                    this.logger.info(&quot;Destroyed ship in (&quot;</span>
<span class="nc" id="L413">                            + this.enemyShips.indexOf(column) + &quot;,&quot; + i + &quot;)&quot;);</span>
                }

        // Updates the list of ships that can shoot the player.
<span class="nc bnc" id="L417" title="All 2 branches missed.">        if (this.shooters.contains(destroyedShip)) {</span>
<span class="nc" id="L418">            int destroyedShipIndex = this.shooters.indexOf(destroyedShip);</span>
<span class="nc" id="L419">            int destroyedShipColumnIndex = -1;</span>

<span class="nc bnc" id="L421" title="All 2 branches missed.">            for (List&lt;EnemyShip&gt; column : this.enemyShips)</span>
<span class="nc bnc" id="L422" title="All 2 branches missed.">                if (column.contains(destroyedShip)) {</span>
<span class="nc" id="L423">                    destroyedShipColumnIndex = this.enemyShips.indexOf(column);</span>
<span class="nc" id="L424">                    break;</span>
                }

<span class="nc" id="L427">            EnemyShip nextShooter = getNextShooter(this.enemyShips</span>
<span class="nc" id="L428">                    .get(destroyedShipColumnIndex));</span>

<span class="nc bnc" id="L430" title="All 2 branches missed.">            if (nextShooter != null)</span>
<span class="nc" id="L431">                this.shooters.set(destroyedShipIndex, nextShooter);</span>
            else {
<span class="nc" id="L433">                this.shooters.remove(destroyedShipIndex);</span>
<span class="nc" id="L434">                this.logger.info(&quot;Shooters list reduced to &quot;</span>
<span class="nc" id="L435">                        + this.shooters.size() + &quot; members.&quot;);</span>
            }
        }

<span class="nc" id="L439">        this.shipCount--;</span>
<span class="nc" id="L440">    }</span>

    /**
     * Gets the ship on a given column that will be in charge of shooting.
     *
     * @param column
     *            Column to search.
     * @return New shooter ship.
     */
    public final EnemyShip getNextShooter(final List&lt;EnemyShip&gt; column) {
<span class="nc" id="L450">        Iterator&lt;EnemyShip&gt; iterator = column.iterator();</span>
<span class="nc" id="L451">        EnemyShip nextShooter = null;</span>
<span class="nc bnc" id="L452" title="All 2 branches missed.">        while (iterator.hasNext()) {</span>
<span class="nc" id="L453">            EnemyShip checkShip = iterator.next();</span>
<span class="nc bnc" id="L454" title="All 4 branches missed.">            if (checkShip != null &amp;&amp; !checkShip.isDestroyed())</span>
<span class="nc" id="L455">                nextShooter = checkShip;</span>
<span class="nc" id="L456">        }</span>

<span class="nc" id="L458">        return nextShooter;</span>
    }

    /**
     * Returns an iterator over the ships in the formation.
     *
     * @return Iterator over the enemy ships.
     */
    @Override
    public final Iterator&lt;EnemyShip&gt; iterator() {
<span class="nc" id="L468">        Set&lt;EnemyShip&gt; enemyShipsList = new HashSet&lt;EnemyShip&gt;();</span>

<span class="nc bnc" id="L470" title="All 2 branches missed.">        for (List&lt;EnemyShip&gt; column : this.enemyShips)</span>
<span class="nc bnc" id="L471" title="All 2 branches missed.">            for (EnemyShip enemyShip : column)</span>
<span class="nc" id="L472">                enemyShipsList.add(enemyShip);</span>

<span class="nc" id="L474">        return enemyShipsList.iterator();</span>
    }


    public boolean lastShip(){
<span class="nc bnc" id="L479" title="All 2 branches missed.">        return this.shipCount == 1;</span>
    }
    /**
     * Checks if there are any ships remaining.
     *
     * @return True when all ships have been destroyed.
     */
    public final boolean isEmpty() {
<span class="nc bnc" id="L487" title="All 2 branches missed.">        return this.shipCount &lt;= 0;</span>
    }

    public int getShipCount() {
<span class="nc" id="L491">        return this.shipCount;</span>
    }
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>